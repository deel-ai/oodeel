
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>OOD methods - OODEEL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="dark" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#oodeel.methods.base" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OODEEL" class="md-header__button md-logo" aria-label="OODEEL" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OODEEL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OOD methods
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="dark" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/deel-ai/oodeel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    deel-ai/oodeel
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OODEEL" class="md-nav__button md-logo" aria-label="OODEEL" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    OODEEL
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/deel-ai/oodeel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    deel-ai/oodeel
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          OOD methods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        OOD methods
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.base" class="md-nav__link">
    oodeel.methods.base
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel" class="md-nav__link">
    OODModel
  </a>
  
    <nav class="md-nav" aria-label="OODModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.calibrate_threshold" class="md-nav__link">
    calibrate_threshold()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.isood" class="md-nav__link">
    isood()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.score" class="md-nav__link">
    score()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods" class="md-nav__link">
    oodeel.methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.DKNN" class="md-nav__link">
    DKNN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.Energy" class="md-nav__link">
    Energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.MLS" class="md-nav__link">
    MLS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.ODIN" class="md-nav__link">
    ODIN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.VIM" class="md-nav__link">
    VIM
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ooddataset/" class="md-nav__link">
        OOD dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../training_funs/" class="md-nav__link">
        Training tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../operators/" class="md-nav__link">
        Operators
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/demo_experiment/" class="md-nav__link">
        Getting started: Maximum Logit Score on MNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/demo_odin/" class="md-nav__link">
        ODIN method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/demo_dknn/" class="md-nav__link">
        Deep KNN method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/demo_vim/" class="md-nav__link">
        Virtual Logit Matching (VIM) method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/demo_energy/" class="md-nav__link">
        Energy method
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.base" class="md-nav__link">
    oodeel.methods.base
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel" class="md-nav__link">
    OODModel
  </a>
  
    <nav class="md-nav" aria-label="OODModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.calibrate_threshold" class="md-nav__link">
    calibrate_threshold()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.isood" class="md-nav__link">
    isood()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oodeel.methods.base.OODModel.score" class="md-nav__link">
    score()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods" class="md-nav__link">
    oodeel.methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.DKNN" class="md-nav__link">
    DKNN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.Energy" class="md-nav__link">
    Energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.MLS" class="md-nav__link">
    MLS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.ODIN" class="md-nav__link">
    ODIN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oodeel.methods.VIM" class="md-nav__link">
    VIM
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/deel-ai/oodeel/edit/master/docs/api/methods.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>OOD methods</h1>

<div class="doc doc-object doc-module">


<a id="oodeel.methods.base"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.base.OODModel" class="doc doc-heading">
        <code>OODModel</code>


<a href="#oodeel.methods.base.OODModel" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Base Class for methods that assign a score to unseen samples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>output_layers_id</code></td>
          <td>
                <code><span title="oodeel.types.List">List</span>[int]</code>
          </td>
          <td><p>list of str or int that identify features to output.
If int, the rank of the layer in the layer list
If str, the name of the layer.
Defaults to [].</p></td>
          <td>
                <code>[-1]</code>
          </td>
        </tr>
        <tr>
          <td><code>output_activation</code></td>
          <td>
          </td>
          <td><p>activation function for the last layer.
Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>flatten</code></td>
          <td>
          </td>
          <td><p>Flatten the output features or not.
Defaults to True.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
          </td>
          <td><p>batch_size used to compute the features space
projection of input data.
Defaults to 256.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/base.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OODModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base Class for methods that assign a score to unseen samples.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_layers_id: list of str or int that identify features to output.</span>
<span class="sd">            If int, the rank of the layer in the layer list</span>
<span class="sd">            If str, the name of the layer.</span>
<span class="sd">            Defaults to [].</span>
<span class="sd">        output_activation: activation function for the last layer.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        flatten: Flatten the output features or not.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        batch_size: batch_size used to compute the features space</span>
<span class="sd">            projection of input data.</span>
<span class="sd">            Defaults to 256.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_layers_id</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">input_layers_id</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_layers_id</span> <span class="o">=</span> <span class="n">output_layers_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_layers_id</span> <span class="o">=</span> <span class="n">input_layers_id</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes an OOD score for input samples &quot;inputs&quot;.</span>
<span class="sd">        Method to override with child classes.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: tensor to score</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare oodmodel for scoring:</span>
<span class="sd">        * Constructs the feature extractor based on the model</span>
<span class="sd">        * Calibrates the oodmodel on ID data &quot;fit_dataset&quot; if needed,</span>
<span class="sd">            using self._fit_to_dataset</span>

<span class="sd">        Args:</span>
<span class="sd">            model: model to extract the features from</span>
<span class="sd">            fit_dataset: dataset to fit the oodmodel on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_feature_extractor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fit_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fit_to_dataset</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_feature_extractor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads feature extractor</span>

<span class="sd">        Args:</span>
<span class="sd">            model : tf.keras model (for now)</span>
<span class="sd">                keras models saved as pb files e.g. with model.save()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_from</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;keras&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">TFOperator</span>
            <span class="kn">from</span> <span class="nn">..models.keras_feature_extractor</span> <span class="kn">import</span> <span class="n">KerasFeatureExtractor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">TFOperator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;tensorflow&quot;</span>
            <span class="n">FeatureExtractor</span> <span class="o">=</span> <span class="n">KerasFeatureExtractor</span>

        <span class="k">elif</span> <span class="n">is_from</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;torch&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">TorchOperator</span>
            <span class="kn">from</span> <span class="nn">..models.torch_feature_extractor</span> <span class="kn">import</span> <span class="n">TorchFeatureExtractor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">TorchOperator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>
            <span class="n">FeatureExtractor</span> <span class="o">=</span> <span class="n">TorchFeatureExtractor</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

        <span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">FeatureExtractor</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">input_layer_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_layers_id</span><span class="p">,</span>
            <span class="n">output_layers_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_layers_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_extractor</span>

    <span class="k">def</span> <span class="nf">_fit_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the oodmodel to fit_dataset.</span>
<span class="sd">        To be overrided in child classes (if needed)</span>

<span class="sd">        Args:</span>
<span class="sd">            fit_dataset: dataset to fit the oodmodel on</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">calibrate_threshold</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span>
        <span class="n">scores</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibrates the model on ID data &quot;id_dataset&quot;.</span>
<span class="sd">        Placeholder for now</span>

<span class="sd">        Args:</span>
<span class="sd">            fit_dataset: dataset to callibrate the threshold on</span>
<span class="sd">            scores: scores of oodmodel</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes an OOD score for input samples &quot;inputs&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: Tensors, or list of tensors to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores or list of scores (depending on the input)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Call .fit() before .score()&quot;</span>

        <span class="c1"># Case 1: dataset is neither a tf.data.Dataset nor a torch.DataLoader</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">TensorType</span><span class="p">):</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
        <span class="c1"># Case 2: dataset is a tf.data.Dataset or a torch.DataLoader</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">):</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">assert</span> <span class="n">is_batched</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s2">&quot;Please input a batched dataset.&quot;</span>
            <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
                <span class="n">score_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">score_batch</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span> <span class="nf">isood</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether the input samples &quot;inputs&quot; are OOD or not, given a threshold</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>
<span class="sd">            threshold: threshold to use for distinguishing between OOD and ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array of 0 for ID samples and 1 for OOD samples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Call .fit() before .isood()&quot;</span>

        <span class="c1"># Case 1: dataset is neither a tf.data.Dataset nor a torch.DataLoader</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">TensorType</span><span class="p">):</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
        <span class="c1"># Case 2: dataset is a tf.data.Dataset or a torch.DataLoader</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">):</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">assert</span> <span class="n">is_batched</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s2">&quot;Please input a batched dataset.&quot;</span>
            <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
                <span class="n">score_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">score_batch</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">oodness</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">&lt;</span> <span class="n">threshold</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">oodness</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience wrapper for isood</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isood</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="oodeel.methods.base.OODModel.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>

<a href="#oodeel.methods.base.OODModel.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Convenience wrapper for isood</p>

      <details class="quote">
        <summary>Source code in <code>oodeel/methods/base.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience wrapper for isood</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isood</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="oodeel.methods.base.OODModel.calibrate_threshold" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calibrate_threshold</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span></code>

<a href="#oodeel.methods.base.OODModel.calibrate_threshold" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Calibrates the model on ID data "id_dataset".
Placeholder for now</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fit_dataset</code></td>
          <td>
                <code><span title="oodeel.types.Union">Union</span>[<span title="oodeel.types.TensorType">TensorType</span>, <span title="oodeel.types.DatasetType">DatasetType</span>]</code>
          </td>
          <td><p>dataset to callibrate the threshold on</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>scores</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>scores of oodmodel</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>NotImplementedError</code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>oodeel/methods/base.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calibrate_threshold</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span>
    <span class="n">scores</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calibrates the model on ID data &quot;id_dataset&quot;.</span>
<span class="sd">    Placeholder for now</span>

<span class="sd">    Args:</span>
<span class="sd">        fit_dataset: dataset to callibrate the threshold on</span>
<span class="sd">        scores: scores of oodmodel</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="oodeel.methods.base.OODModel.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#oodeel.methods.base.OODModel.fit" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Prepare oodmodel for scoring:
* Constructs the feature extractor based on the model
* Calibrates the oodmodel on ID data "fit_dataset" if needed,
    using self._fit_to_dataset</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="oodeel.types.Callable">Callable</span></code>
          </td>
          <td><p>model to extract the features from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fit_dataset</code></td>
          <td>
                <code><span title="oodeel.types.Optional">Optional</span>[<span title="oodeel.types.Union">Union</span>[<span title="oodeel.types.TensorType">TensorType</span>, <span title="oodeel.types.DatasetType">DatasetType</span>]]</code>
          </td>
          <td><p>dataset to fit the oodmodel on</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>oodeel/methods/base.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare oodmodel for scoring:</span>
<span class="sd">    * Constructs the feature extractor based on the model</span>
<span class="sd">    * Calibrates the oodmodel on ID data &quot;fit_dataset&quot; if needed,</span>
<span class="sd">        using self._fit_to_dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        model: model to extract the features from</span>
<span class="sd">        fit_dataset: dataset to fit the oodmodel on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_feature_extractor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fit_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_to_dataset</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="oodeel.methods.base.OODModel.isood" class="doc doc-heading">
<code class="highlight language-python"><span class="n">isood</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>

<a href="#oodeel.methods.base.OODModel.isood" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Returns whether the input samples "inputs" are OOD or not, given a threshold</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>inputs</code></td>
          <td>
          </td>
          <td><p>input samples to score</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>threshold to use for distinguishing between OOD and ID</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.array of 0 for ID samples and 1 for OOD samples</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>oodeel/methods/base.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">isood</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether the input samples &quot;inputs&quot; are OOD or not, given a threshold</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs: input samples to score</span>
<span class="sd">        threshold: threshold to use for distinguishing between OOD and ID</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array of 0 for ID samples and 1 for OOD samples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Call .fit() before .isood()&quot;</span>

    <span class="c1"># Case 1: dataset is neither a tf.data.Dataset nor a torch.DataLoader</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">TensorType</span><span class="p">):</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
    <span class="c1"># Case 2: dataset is a tf.data.Dataset or a torch.DataLoader</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">assert</span> <span class="n">is_batched</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s2">&quot;Please input a batched dataset.&quot;</span>
        <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
            <span class="n">score_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">score_batch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">oodness</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">&lt;</span> <span class="n">threshold</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">oodness</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="oodeel.methods.base.OODModel.score" class="doc doc-heading">
<code class="highlight language-python"><span class="n">score</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span></code>

<a href="#oodeel.methods.base.OODModel.score" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Computes an OOD score for input samples "inputs"</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>inputs</code></td>
          <td>
          </td>
          <td><p>Tensors, or list of tensors to score</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>scores or list of scores (depending on the input)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>oodeel/methods/base.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">score</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes an OOD score for input samples &quot;inputs&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs: Tensors, or list of tensors to score</span>

<span class="sd">    Returns:</span>
<span class="sd">        scores or list of scores (depending on the input)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Call .fit() before .score()&quot;</span>

    <span class="c1"># Case 1: dataset is neither a tf.data.Dataset nor a torch.DataLoader</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">TensorType</span><span class="p">):</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
    <span class="c1"># Case 2: dataset is a tf.data.Dataset or a torch.DataLoader</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">assert</span> <span class="n">is_batched</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s2">&quot;Please input a batched dataset.&quot;</span>
        <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
            <span class="n">score_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">score_batch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="oodeel.methods"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.DKNN" class="doc doc-heading">
        <code>DKNN</code>


<a href="#oodeel.methods.DKNN" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="oodeel.methods.base.OODModel" href="#oodeel.methods.base.OODModel">OODModel</a></code></p>

  
      <p>"Out-of-Distribution Detection with Deep Nearest Neighbors"
https://arxiv.org/abs/2204.06507</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nearest</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of nearest neighbors to consider.
Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>output_layers_id</code></td>
          <td>
                <code><span title="oodeel.types.List">List</span>[int]</code>
          </td>
          <td><p>feature space on which to compute nearest neighbors.
Defaults to [-2].</p></td>
          <td>
                <code>[-2]</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/dknn.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DKNN</span><span class="p">(</span><span class="n">OODModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;Out-of-Distribution Detection with Deep Nearest Neighbors&quot;</span>
<span class="sd">    https://arxiv.org/abs/2204.06507</span>

<span class="sd">    Args:</span>
<span class="sd">        nearest: number of nearest neighbors to consider.</span>
<span class="sd">            Defaults to 1.</span>
<span class="sd">        output_layers_id: feature space on which to compute nearest neighbors.</span>
<span class="sd">            Defaults to [-2].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nearest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">output_layers_id</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">output_layers_id</span><span class="o">=</span><span class="n">output_layers_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nearest</span> <span class="o">=</span> <span class="n">nearest</span>

    <span class="k">def</span> <span class="nf">_fit_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs the index from ID data &quot;fit_dataset&quot;, which will be used for</span>
<span class="sd">        nearest neighbor search.</span>

<span class="sd">        Args:</span>
<span class="sd">            fit_dataset: input dataset (ID) to construct the index with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit_projected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">norm_fit_projected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_l2_normalization</span><span class="p">(</span><span class="n">fit_projected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexFlatL2</span><span class="p">(</span><span class="n">norm_fit_projected</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">norm_fit_projected</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes an OOD score for input samples &quot;inputs&quot; based on</span>
<span class="sd">        the distance to nearest neighbors in the feature space of self.model</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_projected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">norm_input_projected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_l2_normalization</span><span class="p">(</span><span class="n">input_projected</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">norm_input_projected</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearest</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_l2_normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">feat</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.Energy" class="doc doc-heading">
        <code>Energy</code>


<a href="#oodeel.methods.Energy" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="oodeel.methods.base.OODModel" href="#oodeel.methods.base.OODModel">OODModel</a></code></p>

  
      <p>Energy Score method for OOD detection.
"Energy-based Out-of-distribution Detection"
https://arxiv.org/abs/2010.03759</p>
<p>This method assumes that the model has been trained with cross entropy loss
<span class="arithmatex">\(CE(model(x))\)</span> where <span class="arithmatex">\(model(x)=(l_{c})_{c=1}^{C}\)</span> are the logits
predicted for input <span class="arithmatex">\(x\)</span>.
The implementation assumes that the logits are retreieved using the output with
linear activation.</p>
<p>The energy score for input <span class="arithmatex">\(x\)</span> is given by
$$ -\log \sum_{c=0}^C \exp(l_c)$$</p>
<p>where <span class="arithmatex">\(model(x)=(l_{c})_{c=1}^{C}\)</span> are the logits predicted by the model on
<span class="arithmatex">\(x\)</span>.
As always, training data is expected to have lower score than OOD data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batch_size</code></td>
          <td>
          </td>
          <td><p>batch_size used to compute the features space
projection of input data.
Defaults to 256.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/energy.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Energy</span><span class="p">(</span><span class="n">OODModel</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Energy Score method for OOD detection.</span>
<span class="sd">    &quot;Energy-based Out-of-distribution Detection&quot;</span>
<span class="sd">    https://arxiv.org/abs/2010.03759</span>

<span class="sd">    This method assumes that the model has been trained with cross entropy loss</span>
<span class="sd">    $CE(model(x))$ where $model(x)=(l_{c})_{c=1}^{C}$ are the logits</span>
<span class="sd">    predicted for input $x$.</span>
<span class="sd">    The implementation assumes that the logits are retreieved using the output with</span>
<span class="sd">    linear activation.</span>

<span class="sd">    The energy score for input $x$ is given by</span>
<span class="sd">    $$ -\log \sum_{c=0}^C \exp(l_c)$$</span>

<span class="sd">    where $model(x)=(l_{c})_{c=1}^{C}$ are the logits predicted by the model on</span>
<span class="sd">    $x$.</span>
<span class="sd">    As always, training data is expected to have lower score than OOD data.</span>


<span class="sd">    Args:</span>
<span class="sd">        batch_size: batch_size used to compute the features space</span>
<span class="sd">            projection of input data.</span>
<span class="sd">            Defaults to 256.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">output_layers_id</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_layers_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes an OOD score for input samples &quot;inputs&quot; based on</span>
<span class="sd">        energy, namey $-logsumexp(logits(inputs))$.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># compute logits (softmax(logits,axis=1) is the actual softmax</span>
        <span class="c1"># output minimized using binary cross entropy)</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">logsumexp</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.MLS" class="doc doc-heading">
        <code>MLS</code>


<a href="#oodeel.methods.MLS" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="oodeel.methods.base.OODModel" href="#oodeel.methods.base.OODModel">OODModel</a></code></p>

  
      <p>Maximum Logit Scores method for OOD detection.
"Open-Set Recognition: a Good Closed-Set Classifier is All You Need?"
https://arxiv.org/abs/2110.06207,
and Maximum Softmax Score
"A Baseline for Detecting Misclassified and Out-of-Distribution Examples
in Neural Networks"
http://arxiv.org/abs/1610.02136</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>output_activation</code></td>
          <td>
          </td>
          <td><p>activation function for the last layer. If "linear",
the method is MLS and if "softmax", the method is MSS.
Defaults to "linear".</p></td>
          <td>
                <code>&#39;linear&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
          </td>
          <td><p>batch_size used to compute the features space
projection of input data.
Defaults to 256.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/mls.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MLS</span><span class="p">(</span><span class="n">OODModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maximum Logit Scores method for OOD detection.</span>
<span class="sd">    &quot;Open-Set Recognition: a Good Closed-Set Classifier is All You Need?&quot;</span>
<span class="sd">    https://arxiv.org/abs/2110.06207,</span>
<span class="sd">    and Maximum Softmax Score</span>
<span class="sd">    &quot;A Baseline for Detecting Misclassified and Out-of-Distribution Examples</span>
<span class="sd">    in Neural Networks&quot;</span>
<span class="sd">    http://arxiv.org/abs/1610.02136</span>



<span class="sd">    Args:</span>
<span class="sd">        output_activation: activation function for the last layer. If &quot;linear&quot;,</span>
<span class="sd">            the method is MLS and if &quot;softmax&quot;, the method is MSS.</span>
<span class="sd">            Defaults to &quot;linear&quot;.</span>
<span class="sd">        batch_size: batch_size used to compute the features space</span>
<span class="sd">            projection of input data.</span>
<span class="sd">            Defaults to 256.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_activation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">):</span>
        <span class="c1"># This line is not necessary but improves readability</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">output_layers_id</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_layers_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_activation</span> <span class="o">=</span> <span class="n">output_activation</span>

    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes an OOD score for input samples &quot;inputs&quot; based on</span>
<span class="sd">        the distance to nearest neighbors in the feature space of self.model</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_activation</span> <span class="o">==</span> <span class="s2">&quot;softmax&quot;</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.ODIN" class="doc doc-heading">
        <code>ODIN</code>


<a href="#oodeel.methods.ODIN" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="oodeel.methods.base.OODModel" href="#oodeel.methods.base.OODModel">OODModel</a></code></p>

  
      <p>"Enhancing The Reliability of Out-of-distribution Image Detection
in Neural Networks"
http://arxiv.org/abs/1706.02690</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>temperature</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Temperature parameter. Defaults to 1000.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>noise</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Perturbation noise. Defaults to 0.014.</p></td>
          <td>
                <code>0.014</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/odin.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ODIN</span><span class="p">(</span><span class="n">OODModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;Enhancing The Reliability of Out-of-distribution Image Detection</span>
<span class="sd">    in Neural Networks&quot;</span>
<span class="sd">    http://arxiv.org/abs/1706.02690</span>

<span class="sd">    Args:</span>
<span class="sd">        temperature (float, optional): Temperature parameter. Defaults to 1000.</span>
<span class="sd">        noise (float, optional): Perturbation noise. Defaults to 0.014.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.014</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">output_layers_id</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_layers_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>

    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes an OOD score for input samples &quot;inputs&quot; based on</span>
<span class="sd">        the distance to nearest neighbors in the feature space of self.model</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">get_input_from_dataset_elem</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_perturbation</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span> <span class="nf">input_perturbation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_temperature_loss</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="n">inputs_p</span> <span class="o">=</span> <span class="n">inputs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">gradients</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputs_p</span>

    <span class="k">def</span> <span class="nf">_temperature_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)(</span><span class="n">labels</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="oodeel.methods.VIM" class="doc doc-heading">
        <code>VIM</code>


<a href="#oodeel.methods.VIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="oodeel.methods.base.OODModel" href="#oodeel.methods.base.OODModel">OODModel</a></code></p>

  
      <p>Compute the Virtual Matching Logit (VIM) score.
https://arxiv.org/abs/2203.10807</p>
<p>This score combines the energy score with a PCA residual score.</p>
<p>The energy score is the logarithm of the sum of exponential of logits.
The PCA residual score is based on the projection on residual dimensions for
principal component analysis.
    Residual dimensions are the eigenvectors corresponding to the least eignevalues
    (least variance).
    Intuitively, this score method assumes that feature representations of ID data
    occupy a low dimensional affine subspace <span class="arithmatex">\(P+c\)</span> of the feature space.
    Specifically, the projection of ID data translated by <span class="arithmatex">\(-c\)</span> on the
    orthognoal complement <span class="arithmatex">\(P^{\perp}\)</span> is expected to have small norm.
    It allows to detect points whose feature representation lie far from the
    identified affine subspace, namely those points <span class="arithmatex">\(x\)</span> such that the
    projection on <span class="arithmatex">\(P^{\perp}\)</span> of <span class="arithmatex">\(x-c\)</span> has large norm.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>princ_dims</code></td>
          <td>
                <code><span title="oodeel.types.Union">Union</span>[int, float]</code>
          </td>
          <td><p>number of principal dimensions of in distribution features to</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>pca_origin</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>either "center" for using the mean of the data in feature space, or</p></td>
          <td>
                <code>&#39;center&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_layers_id</code></td>
          <td>
                <code><span title="oodeel.types.List">List</span>[int]</code>
          </td>
          <td><p>features to use for Residual and Energy score.
Defaults to [-2,-1] (-2 the features for PCA residual, -1 the logits with
output_activation="linear" for Energy).</p></td>
          <td>
                <code>[-2, -1]</code>
          </td>
        </tr>
        <tr>
          <td><code>output_activation</code></td>
          <td>
          </td>
          <td><p>output activation to use.
Defaults to "linear".</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
          </td>
          <td><p>batch_size used to compute the features space
projection of input data.
Defaults to 256.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>oodeel/methods/vim.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VIM</span><span class="p">(</span><span class="n">OODModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Virtual Matching Logit (VIM) score.</span>
<span class="sd">    https://arxiv.org/abs/2203.10807</span>

<span class="sd">    This score combines the energy score with a PCA residual score.</span>

<span class="sd">    The energy score is the logarithm of the sum of exponential of logits.</span>
<span class="sd">    The PCA residual score is based on the projection on residual dimensions for</span>
<span class="sd">    principal component analysis.</span>
<span class="sd">        Residual dimensions are the eigenvectors corresponding to the least eignevalues</span>
<span class="sd">        (least variance).</span>
<span class="sd">        Intuitively, this score method assumes that feature representations of ID data</span>
<span class="sd">        occupy a low dimensional affine subspace $P+c$ of the feature space.</span>
<span class="sd">        Specifically, the projection of ID data translated by $-c$ on the</span>
<span class="sd">        orthognoal complement $P^{\\perp}$ is expected to have small norm.</span>
<span class="sd">        It allows to detect points whose feature representation lie far from the</span>
<span class="sd">        identified affine subspace, namely those points $x$ such that the</span>
<span class="sd">        projection on $P^{\\perp}$ of $x-c$ has large norm.</span>

<span class="sd">    Args:</span>
<span class="sd">        princ_dims: number of principal dimensions of in distribution features to</span>
<span class="sd">        consider.</span>
<span class="sd">            If an int, must be less than the dimension of the feature space.</span>
<span class="sd">            If a float, it must be in [0,1), it represents the ratio of explained</span>
<span class="sd">            variance to consider to determine the number of principal components.</span>
<span class="sd">            If None, the kneedle algorithm is used to determine the number of</span>
<span class="sd">            dimensions.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        pca_origin: either &quot;center&quot; for using the mean of the data in feature space, or</span>
<span class="sd">        &quot;pseudo&quot; for using $W^{-1}b$ where $W^{-1}$ is the pseudo inverse of the final</span>
<span class="sd">        linear layer applied to bias term (as in the VIM paper).</span>
<span class="sd">            Defaults to &quot;center&quot;.</span>
<span class="sd">        output_layers_id: features to use for Residual and Energy score.</span>
<span class="sd">            Defaults to [-2,-1] (-2 the features for PCA residual, -1 the logits with</span>
<span class="sd">            output_activation=&quot;linear&quot; for Energy).</span>
<span class="sd">        output_activation: output activation to use.</span>
<span class="sd">            Defaults to &quot;linear&quot;.</span>
<span class="sd">        batch_size: batch_size used to compute the features space</span>
<span class="sd">            projection of input data.</span>
<span class="sd">            Defaults to 256.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">princ_dims</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pca_origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">output_layers_id</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">output_layers_id</span><span class="o">=</span><span class="n">output_layers_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">=</span> <span class="n">princ_dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pca_origin</span> <span class="o">=</span> <span class="n">pca_origin</span>

    <span class="k">def</span> <span class="nf">_fit_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorType</span><span class="p">,</span> <span class="n">DatasetType</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes principal components of feature representations and store the residual</span>
<span class="sd">        eigenvectors.</span>
<span class="sd">        Computes a scaling factor constant :math:&#39;\alpha&#39; such that the average scaled</span>
<span class="sd">        residual score (on train) is equal to the average maximum logit score (MLS)</span>
<span class="sd">        score.</span>

<span class="sd">        Args:</span>
<span class="sd">            fit_dataset: input dataset (ID) to construct the index with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_train</span><span class="p">,</span> <span class="n">logits_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fit_dataset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span> <span class="o">=</span> <span class="n">features_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pca_origin</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pca_origin</span> <span class="o">==</span> <span class="s2">&quot;pseudo&quot;</span><span class="p">:</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">pinv</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;only &quot;center&quot; and &quot;pseudo&quot; are available for argument &quot;pca_origin&quot;&#39;</span>
            <span class="p">)</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="n">EmpiricalCovariance</span><span class="p">(</span><span class="n">assume_centered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">ec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="c1"># compute eigenvalues and eigenvectors of empirical covariance matrix</span>
        <span class="n">eig_vals</span><span class="p">,</span> <span class="n">eigen_vectors</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">covariance_</span><span class="p">)</span>
        <span class="c1"># allow to use Kneedle to find res_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">eig_vals</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_kneed</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_kneed_not_found_err</span>
            <span class="c1"># we use kneedle to look for an elbow point to set the number of principal</span>
            <span class="c1"># dimensions</span>
            <span class="c1"># we apply kneedle to the function cumsum(eigvals) which maps a dimension d</span>
            <span class="c1"># to the variance of the d dimensional (principal) subspace with lowest</span>
            <span class="c1"># variance.</span>
            <span class="c1"># since eigvals is non decreasing, cumsum(eigvals) is always convex and</span>
            <span class="c1"># increasing.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kneedle</span> <span class="o">=</span> <span class="n">KneeLocator</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">)),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">),</span>
                <span class="n">S</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">curve</span><span class="o">=</span><span class="s2">&quot;convex&quot;</span><span class="p">,</span>
                <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;increasing&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kneedle</span><span class="o">.</span><span class="n">elbow</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="mi">0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Found invalid number of residual dimensions (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span><span class="si">}</span><span class="s2">) &quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found an elbow point for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span><span class="si">}</span><span class="s2"> principal &quot;</span>
                    <span class="s2">&quot;dimensions inside the </span><span class="si">{self.feature_dim}</span><span class="s2"> dimensional feature space.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;You can visualize this elbow by calling the method &#39;.plot_spectrum()&#39; &quot;</span>
                <span class="s2">&quot;of this class&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;if &#39;princ_dims&#39;(=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="si">}</span><span class="s2">) is an int, it must be less than &quot;</span>
                <span class="s2">&quot;feature space dimension =</span><span class="si">{self.feature_dim}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">&lt;</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;if &#39;princ_dims&#39;(=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="si">}</span><span class="s2">) is a float, it must be in [0,1)&quot;</span>
            <span class="n">explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">explained_variance</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">eigen_vectors</span><span class="p">[:,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># compute residual score on training data</span>
        <span class="n">train_residual_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_residual_score_tensor</span><span class="p">(</span><span class="n">features_train</span><span class="p">)</span>
        <span class="c1"># compute MLS on training data</span>
        <span class="n">train_mls_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">logits_train</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># compute scaling factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train_mls_scores</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train_residual_scores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compute_residual_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TensorType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the norm of the residual projection in the feature space.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
        <span class="c1"># taking the norm of the coordinates, which amounts to the norm of</span>
        <span class="c1"># the projection since the eigenvectors form an orthornomal basis</span>
        <span class="n">res_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">res_coordinates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res_norm</span>

    <span class="k">def</span> <span class="nf">_residual_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the residual score for input samples &quot;inputs&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Call .fit() before .score()&quot;</span>
        <span class="c1"># compute predicted features</span>

        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">res_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_residual_score_tensor</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res_scores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">TensorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the VIM score for input samples &quot;inputs&quot; as the sum of the energy</span>
<span class="sd">        score and a scaled (PCA) residual norm in the feature space.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: input samples to score</span>

<span class="sd">        Returns:</span>
<span class="sd">            scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compute predicted features</span>

        <span class="n">features</span><span class="p">,</span> <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">res_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_residual_score_tensor</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">energy_scores</span> <span class="o">=</span> <span class="n">logsumexp</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">res_scores</span> <span class="o">+</span> <span class="n">energy_scores</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;kneedle&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kneedle</span><span class="o">.</span><span class="n">plot_knee</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Explained variance&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of principal dimensions&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found elbow at dimension </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kneedle</span><span class="o">.</span><span class="n">elbow</span><span class="si">}</span><span class="se">\n</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_dim</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kneedle</span><span class="o">.</span><span class="n">elbow</span><span class="si">}</span><span class="s2"> principal dimensions&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_dim</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Number of principal dimensions = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_princ_dim</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Explained variance&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of principal dimensions&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Explained variance by number of principal dimensions&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../.." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../ooddataset/" class="md-footer__link md-footer__link--next" aria-label="Next: OOD dataset" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              OOD dataset
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
    
  </body>
</html>